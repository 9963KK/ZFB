import Foundation

class IngredientEmojiManager {
    static let shared = IngredientEmojiManager()
    
    // é¢„å®šä¹‰çš„é£Ÿæemojiæ˜ å°„
    private var emojiMap: [String: String] = [
        // æ°´æœ
        "è‹¹æœ": "ğŸ",
        "é’è‹¹æœ": "ğŸ",
        "æ©˜å­": "ğŸŠ",
        "æ©™å­": "ğŸŠ",
        "é¦™è•‰": "ğŸŒ",
        "è‘¡è„": "ğŸ‡",
        "è¥¿ç“œ": "ğŸ‰",
        "æ¡ƒå­": "ğŸ‘",
        "æ¢¨": "ğŸ",
        "è‰è“": "ğŸ“",
        "æŸ æª¬": "ğŸ‹",
        "æ¨±æ¡ƒ": "ğŸ’",
        "è“è“": "ğŸ«",
        "æ¤°å­": "ğŸ¥¥",
        "ç«é¾™æœ": "ğŸ‰",
        "çŒ•çŒ´æ¡ƒ": "ğŸ¥",
        "è è": "ğŸ",
        "æŸšå­": "ğŸŠ",
        "çŸ³æ¦´": "ğŸ«",
        "å±±ç«¹": "ğŸ«",
        "æ— èŠ±æœ": "ğŸ«",
        
        // è”¬èœ
        "èƒ¡èåœ": "ğŸ¥•",
        "è¥¿å…°èŠ±": "ğŸ¥¦",
        "èŒ„å­": "ğŸ†",
        "åœŸè±†": "ğŸ¥”",
        "ç•ªèŒ„": "ğŸ…",
        "å°ç•ªèŒ„": "ğŸ…",
        "ç‰ç±³": "ğŸŒ½",
        "ç”Ÿèœ": "ğŸ¥¬",
        "å·å¿ƒèœ": "ğŸ¥¬",
        "è¾£æ¤’": "ğŸŒ¶ï¸",
        "é’æ¤’": "ğŸ«‘",
        "è˜‘è‡": "ğŸ„",
        "å¤§è’œ": "ğŸ§„",
        "æ´‹è‘±": "ğŸ§…",
        "é»„ç“œ": "ğŸ¥’",
        "è±Œè±†": "ğŸ«›",
        "èŠ¦ç¬‹": "ğŸ¥¬",
        "è èœ": "ğŸ¥¬",
        "éŸ­èœ": "ğŸ¥¬",
        "ç™½èœ": "ğŸ¥¬",
        "å—ç“œ": "ğŸƒ",
        "å†¬ç“œ": "ğŸ¥¬",
        "è‹¦ç“œ": "ğŸ¥’",
        "ä¸ç“œ": "ğŸ¥’",
        "è±†è§’": "ğŸ«›",
        "è±†èŠ½": "ğŸŒ±",
        "è´ç¬‹": "ğŸ¥¬",
        "èŠ¹èœ": "ğŸ¥¬",
        "èåœ": "ğŸ¥•",
        "ç´«ç”˜è“": "ğŸ¥¬",
        "ç«¹ç¬‹": "ğŸ",
        "å±±è¯": "ğŸ¥”",
        "è²è—•": "ğŸ¥”",
        
        // è‚‰ç±»å’Œè›‹
        // çŒªè‚‰ç³»åˆ—
        "çŒªè‚‰": "ğŸ·",
        "äº”èŠ±è‚‰": "ğŸ¥“",
        "çŒªé‡Œè„Š": "ğŸ·",
        "çŒªå‰è…¿": "ğŸ·",
        "çŒªåè…¿": "ğŸ·",
        "çŒªè‚˜": "ğŸ·",
        "çŒªè¹„": "ğŸ·",
        "çŒªæ’éª¨": "ğŸ–",
        "çŒªè‚‹æ’": "ğŸ–",
        "çŒªè…©è‚‰": "ğŸ¥“",
        "çŒªæ¢…èŠ±è‚‰": "ğŸ·",
        "çŒªç˜¦è‚‰": "ğŸ·",
        "çŒªè‚": "ğŸ·",
        "çŒªå¿ƒ": "ğŸ·",
        "çŒªè‚š": "ğŸ·",
        "çŒªå¤§è‚ ": "ğŸ·",
        "çŒªå°è‚ ": "ğŸ·",
        
        // ç‰›è‚‰ç³»åˆ—
        "ç‰›è‚‰": "ğŸ®",
        "ç‰›é‡Œè„Š": "ğŸ¥©",
        "ç‰›æ’": "ğŸ¥©",
        "ç‰›è…©": "ğŸ®",
        "ç‰›è‚‹æ¡": "ğŸ¥©",
        "ç‰›è…±å­": "ğŸ®",
        "ç‰›ç­‹": "ğŸ®",
        "ç‰›è‚": "ğŸ®",
        "ç‰›ç™¾å¶": "ğŸ®",
        "ç‰›å°¾": "ğŸ®",
        "ç‰›èˆŒ": "ğŸ®",
        "ç‰›è‚š": "ğŸ®",
        "ç‰›éª¨": "ğŸ–",
        "ç‰›è‚‹æ’": "ğŸ–",
        "ç‰›æ¿è…±": "ğŸ¥©",
        "ç‰›çœ¼è‚‰": "ğŸ¥©",
        
        // ç¾Šè‚‰ç³»åˆ—
        "ç¾Šè‚‰": "ğŸ‘",
        "ç¾Šæ’": "ğŸ–",
        "ç¾Šè…¿": "ğŸ‘",
        "ç¾Šé‡Œè„Š": "ğŸ‘",
        "ç¾Šè‚‹æ’": "ğŸ–",
        "ç¾Šèå­": "ğŸ‘",
        "ç¾Šè‚": "ğŸ‘",
        "ç¾Šè‚š": "ğŸ‘",
        "ç¾Šéª¨": "ğŸ–",
        
        // é¸¡è‚‰ç³»åˆ—
        "é¸¡è‚‰": "ğŸ”",
        "é¸¡èƒ¸è‚‰": "ğŸ—",
        "é¸¡ç¿…": "ğŸ—",
        "é¸¡è…¿": "ğŸ—",
        "é¸¡ç¿…æ ¹": "ğŸ—",
        "é¸¡ç¿…ä¸­": "ğŸ—",
        "é¸¡çˆª": "ğŸ”",
        "é¸¡å¿ƒ": "ğŸ”",
        "é¸¡è‚": "ğŸ”",
        "é¸¡èƒ—": "ğŸ”",
        "ç«¥å­é¸¡": "ğŸ”",
        "ä¸‰é»„é¸¡": "ğŸ”",
        
        // é¸­è‚‰ç³»åˆ—
        "é¸­è‚‰": "ğŸ¦†",
        "é¸­èƒ¸è‚‰": "ğŸ¦†",
        "é¸­è…¿": "ğŸ¦†",
        "é¸­ç¿…": "ğŸ¦†",
        "é¸­èˆŒ": "ğŸ¦†",
        "é¸­è‚": "ğŸ¦†",
        "é¸­èƒ—": "ğŸ¦†",
        "åŒ—äº¬çƒ¤é¸­": "ğŸ¦†",
        
        // é¹…è‚‰ç³»åˆ—
        "é¹…è‚‰": "ğŸ¦¢",
        "é¹…èƒ¸è‚‰": "ğŸ¦¢",
        "é¹…è…¿": "ğŸ¦¢",
        "é¹…è‚": "ğŸ¦¢",
        "é¹…ç¿…": "ğŸ¦¢",
        
        // å…”è‚‰ç³»åˆ—
        "å…”è‚‰": "ğŸ°",
        "å…”è…¿": "ğŸ°",
        "å…”é‡Œè„Š": "ğŸ°",
        
        // åŠ å·¥è‚‰åˆ¶å“
        "ç«è…¿": "ğŸ–",
        "é¦™è‚ ": "ğŸŒ­",
        "åŸ¹æ ¹": "ğŸ¥“",
        "è…Šè‚ ": "ğŸŒ­",
        "è…Šè‚‰": "ğŸ¥“",
        "ç†è‚‰": "ğŸ¥“",
        "è‚‰æ¾": "ğŸ¥“",
        "è‚‰è„¯": "ğŸ¥“",
        
        // è›‹ç±»
        "é¸¡è›‹": "ğŸ¥š",
        "é¸­è›‹": "ğŸ¥š",
        "é¹…è›‹": "ğŸ¥š",
        "çš®è›‹": "ğŸ¥š",
        "å’¸è›‹": "ğŸ¥š",
        "èŒ¶å¶è›‹": "ğŸ¥š",
        "å’¸é¸­è›‹": "ğŸ¥š",
        "é¹Œé¹‘è›‹": "ğŸ¥š",
        
        // æµ·é²œ
        "è™¾": "ğŸ¦",
        "é¾™è™¾": "ğŸ¦",
        "èƒèŸ¹": "ğŸ¦€",
        "é±¼": "ğŸŸ",
        "ä¸‰æ–‡é±¼": "ğŸŸ",
        "å¸¦é±¼": "ğŸŸ",
        "é²é±¼": "ğŸš",
        "ç”Ÿèš": "ğŸ¦ª",
        "é±¿é±¼": "ğŸ¦‘",
        "ç« é±¼": "ğŸ™",
        "æµ·å‚": "ğŸª¸",
        "é³—é±¼": "ğŸŸ",
        "æ‰‡è´": "ğŸš",
        "æµ·èœ‡": "ğŸ",
        "æµ·å¸¦": "ğŸŒ¿",
        "ç´«èœ": "ğŸŒ¿",
        
        // ä¸»é£Ÿ
        "é¢åŒ…": "ğŸ",
        "ç±³é¥­": "ğŸš",
        "é¢æ¡": "ğŸœ",
        "é¥ºå­": "ğŸ¥Ÿ",
        "é¦’å¤´": "ğŸ",
        "åŒ…å­": "ğŸ¥Ÿ",
        "ä¸‰æ˜æ²»": "ğŸ¥ª",
        "æ±‰å ¡": "ğŸ”",
        "æŠ«è¨": "ğŸ•",
        "ç²½å­": "ğŸ™",
        "å¯¿å¸": "ğŸ±",
        "æ˜¥å·": "ğŸ¥¢",
        "ç‚’é¥­": "ğŸš",
        "ç‚’é¢": "ğŸœ",
        
        // ä¹³åˆ¶å“
        "ç‰›å¥¶": "ğŸ¥›",
        "å¥¶é…ª": "ğŸ§€",
        "é»„æ²¹": "ğŸ§ˆ",
        "é…¸å¥¶": "ğŸ¥›",
        "å¥¶æ²¹": "ğŸ§ˆ",
        "èŠå£«": "ğŸ§€",
        
        // è°ƒå‘³æ–™
        "ç›": "ğŸ§‚",
        "ç³–": "ğŸ¯",
        "é…±æ²¹": "ğŸ«—",
        "é†‹": "ğŸ«—",
        "æ–™é…’": "ğŸ¶",
        "èŠ±æ¤’": "ğŸŒ¶ï¸",
        "å…«è§’": "â­ï¸",
        "è¾£æ¤’ç²‰": "ğŸŒ¶ï¸",
        "è’œç²‰": "ğŸ§„",
        "å§œ": "ğŸ«š",
        "èŠéº»": "âš«ï¸",
        "èŠ¥æœ«": "ğŸŸ¡",
        "ç•ªèŒ„é…±": "ğŸ…",
        "èšæ²¹": "ğŸ¦ª",
        
        // åšæœ
        "èŠ±ç”Ÿ": "ğŸ¥œ",
        "ç“œå­ä»": "ğŸŒ±",
        "æ ¸æ¡ƒ": "ğŸŒ°",
        "æä»": "ğŸ¥œ",
        "è…°æœ": "ğŸ¥œ",
        "å¼€å¿ƒæœ": "ğŸ¥œ",
        "æ¦›å­": "ğŸŒ°",
        "æ¾å­": "ğŸŒ°",
        "ç™½æœ": "ğŸ¥œ",
        
        // é›¶é£Ÿå’Œç”œç‚¹
        "é¥¼å¹²": "ğŸª",
        "è–¯ç‰‡": "ğŸŸ",
        "å·§å…‹åŠ›": "ğŸ«",
        "è›‹ç³•": "ğŸ°",
        "å†°æ·‡æ·‹": "ğŸ¦",
        "ç”œç”œåœˆ": "ğŸ©",
        "æ£’æ£’ç³–": "ğŸ­",
        "ç³–æœ": "ğŸ¬",
        "çˆ†ç±³èŠ±": "ğŸ¿",
        "å¸ƒä¸": "ğŸ®",
        "æœˆé¥¼": "ğŸ¥®",
        "éº»èŠ±": "ğŸ¥¨",
        "ç“œå­": "ğŸŒ±",
        "æœå†»": "ğŸ«˜",
        
        // é¥®æ–™
        "å’–å•¡": "â˜•ï¸",
        "èŒ¶": "ğŸ«–",
        "å•¤é…’": "ğŸº",
        "æœæ±": "ğŸ§ƒ",
        "å¯ä¹": "ğŸ¥¤",
        "çº¢é…’": "ğŸ·",
        "ç™½é…’": "ğŸ¥ƒ",
        "å¥¶èŒ¶": "ğŸ§‹",
        "æ¤°æ±": "ğŸ¥¥",
        "è±†æµ†": "ğŸ¥›",
        "çŸ¿æ³‰æ°´": "ğŸ’§"
    ]
    
    private let userDefaultsKey = "CustomIngredientEmojis"
    
    private init() {
        loadCustomEmojis()
    }
    
    // è·å–é£Ÿæå¯¹åº”çš„emoji
    func getEmoji(for ingredient: String) -> String? {
        // ç§»é™¤ç©ºæ ¼å¹¶è½¬æ¢ä¸ºå°å†™è¿›è¡ŒåŒ¹é…
        let normalizedName = ingredient.trimmingCharacters(in: .whitespaces).lowercased()
        
        // æŸ¥æ‰¾å®Œå…¨åŒ¹é…
        if let emoji = emojiMap[ingredient] {
            return emoji
        }
        
        // æŸ¥æ‰¾åŒ…å«å…³ç³»
        for (key, emoji) in emojiMap {
            if normalizedName.contains(key.lowercased()) {
                return emoji
            }
        }
        
        return nil
    }
    
    // æ·»åŠ è‡ªå®šä¹‰emojiæ˜ å°„
    func addCustomEmoji(ingredient: String, emoji: String) {
        emojiMap[ingredient] = emoji
        saveCustomEmojis()
    }
    
    // åˆ é™¤è‡ªå®šä¹‰emojiæ˜ å°„
    func removeCustomEmoji(ingredient: String) {
        emojiMap.removeValue(forKey: ingredient)
        saveCustomEmojis()
    }
    
    // è·å–æ‰€æœ‰æ˜ å°„
    func getAllMappings() -> [String: String] {
        return emojiMap
    }
    
    // ä¿å­˜è‡ªå®šä¹‰emojiåˆ°UserDefaults
    private func saveCustomEmojis() {
        UserDefaults.standard.set(emojiMap, forKey: userDefaultsKey)
    }
    
    // ä»UserDefaultsåŠ è½½è‡ªå®šä¹‰emoji
    private func loadCustomEmojis() {
        if let savedEmojis = UserDefaults.standard.dictionary(forKey: userDefaultsKey) as? [String: String] {
            emojiMap.merge(savedEmojis) { (_, new) in new }
        }
    }
}
