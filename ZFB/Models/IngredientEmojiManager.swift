import Foundation

class IngredientEmojiManager {
    static let shared = IngredientEmojiManager()
    
    // é¢„å®šä¹‰çš„é£Ÿæemojiæ˜ å°„
    private var emojiMap: [String: String] = [
        // ä¸»é£Ÿç±»
        "å¤§ç±³": "ðŸš",
        "ç³¯ç±³": "ðŸš",
        "å°ç±³": "ðŸŒ¾",
        "é¢æ¡": "ðŸœ",
        "é¢åŒ…": "ðŸž",
        "é¦’å¤´": "ðŸž",
        "é¥ºå­": "ðŸ¥Ÿ",
        "åŒ…å­": "ðŸž",
        "èŠ±å·": "ðŸ¥–",
        "æ²¹æ¡": "ðŸ¥–",
        "å¹´ç³•": "ðŸ˜",
        "ç²½å­": "ðŸ™",
        "ä¸‰æ˜Žæ²»": "ðŸ¥ª",
        "æ±‰å ¡": "ðŸ”",
        "æŠ«è¨": "ðŸ•",
        "å¯¿å¸": "ðŸ±",
        "æ˜¥å·": "ðŸ¥¢",
        "ç‚’é¥­": "ðŸš",
        "ç‚’é¢": "ðŸœ",
        
        // æ°´æžœç±»
        "è‹¹æžœ": "ðŸŽ",
        "é’è‹¹æžœ": "ðŸ",
        "æ©˜å­": "ðŸŠ",
        "æ©™å­": "ðŸŠ",
        "é¦™è•‰": "ðŸŒ",
        "è‘¡è„": "ðŸ‡",
        "è¥¿ç“œ": "ðŸ‰",
        "æ¡ƒå­": "ðŸ‘",
        "æ¢¨": "ðŸ",
        "è‰èŽ“": "ðŸ“",
        "æŸ æª¬": "ðŸ‹",
        "æ¨±æ¡ƒ": "ðŸ’",
        "è“èŽ“": "ðŸ«",
        "æ¤°å­": "ðŸ¥¥",
        "ç«é¾™æžœ": "ðŸ¥",
        "çŒ•çŒ´æ¡ƒ": "ðŸ¥",
        "è è": "ðŸ",
        "æŸšå­": "ðŸŠ",
        "çŸ³æ¦´": "ðŸ«",
        "å±±ç«¹": "ðŸ«",
        "èŠ’æžœ": "ðŸ¥­",
        "æ¦´èŽ²": "ðŸ¥",
        "æœ¨ç“œ": "ðŸ¥",
        "æž£": "ðŸ«",
        "æ— èŠ±æžœ": "ðŸ«",
        "ç™¾é¦™æžœ": "ðŸ¥",
        
        // è”¬èœç±»
        "èƒ¡èåœ": "ðŸ¥•",
        "è¥¿å…°èŠ±": "ðŸ¥¦",
        "èŒ„å­": "ðŸ†",
        "åœŸè±†": "ðŸ¥”",
        "ç•ªèŒ„": "ðŸ…",
        "å°ç•ªèŒ„": "ðŸ…",
        "çŽ‰ç±³": "ðŸŒ½",
        "ç”Ÿèœ": "ðŸ¥¬",
        "å·å¿ƒèœ": "ðŸ¥¬",
        "è¾£æ¤’": "ðŸŒ¶ï¸",
        "é’æ¤’": "ðŸ«‘",
        "è˜‘è‡": "ðŸ„",
        "å¤§è’œ": "ðŸ§„",
        "æ´‹è‘±": "ðŸ§…",
        "é»„ç“œ": "ðŸ¥’",
        "è±Œè±†": "ðŸ«›",
        "èŠ¦ç¬‹": "ðŸ¥¬",
        "è èœ": "ðŸ¥¬",
        "éŸ­èœ": "ðŸ¥¬",
        "ç™½èœ": "ðŸ¥¬",
        "å—ç“œ": "ðŸŽƒ",
        "å†¬ç“œ": "ðŸ¥¬",
        "è‹¦ç“œ": "ðŸ¥’",
        "ä¸ç“œ": "ðŸ¥’",
        "è±†è§’": "ðŸ«›",
        "è±†èŠ½": "ðŸŒ±",
        "èŽ´ç¬‹": "ðŸ¥¬",
        "èŠ¹èœ": "ðŸ¥¬",
        "èåœ": "ðŸ¥•",
        "ç´«ç”˜è“": "ðŸ¥¬",
        "ç«¹ç¬‹": "ðŸŽ",
        "å±±è¯": "ðŸ¥”",
        "èŽ²è—•": "ðŸ¥”",
        
        // è±†åˆ¶å“
        "è±†è…": "ðŸ§Š",
        "è±†å¹²": "ðŸ§Š",
        "è…ç«¹": "ðŸ§Š",
        
        // è‚‰ç±»
        // çŒªè‚‰ç³»åˆ—
        "çŒªè‚‰": "ðŸ·",
        "äº”èŠ±è‚‰": "ðŸ¥“",
        "çŒªé‡Œè„Š": "ðŸ·",
        "çŒªå‰è…¿": "ðŸ·",
        "çŒªåŽè…¿": "ðŸ·",
        "çŒªè‚˜": "ðŸ·",
        "çŒªè¹„": "ðŸ·",
        "çŒªæŽ’éª¨": "ðŸ–",
        "çŒªè‚‹æŽ’": "ðŸ–",
        "çŒªè…©è‚‰": "ðŸ¥“",
        "çŒªæ¢…èŠ±è‚‰": "ðŸ·",
        "çŒªç˜¦è‚‰": "ðŸ·",
        "çŒªè‚": "ðŸ·",
        "çŒªå¿ƒ": "ðŸ·",
        "çŒªè‚š": "ðŸ·",
        "çŒªå¤§è‚ ": "ðŸ·",
        "çŒªå°è‚ ": "ðŸ·",
        
        // ç‰›è‚‰ç³»åˆ—
        "ç‰›è‚‰": "ðŸ®",
        "ç‰›é‡Œè„Š": "ðŸ¥©",
        "ç‰›æŽ’": "ðŸ¥©",
        "ç‰›è…©": "ðŸ®",
        "ç‰›è‚‹æ¡": "ðŸ¥©",
        "ç‰›è…±å­": "ðŸ®",
        "ç‰›ç­‹": "ðŸ®",
        "ç‰›è‚": "ðŸ®",
        "ç‰›ç™¾å¶": "ðŸ®",
        "ç‰›å°¾": "ðŸ®",
        "ç‰›èˆŒ": "ðŸ®",
        "ç‰›è‚š": "ðŸ®",
        "ç‰›éª¨": "ðŸ–",
        "ç‰›è‚‹æŽ’": "ðŸ–",
        "ç‰›æ¿è…±": "ðŸ¥©",
        "ç‰›çœ¼è‚‰": "ðŸ¥©",
        
        // ç¾Šè‚‰ç³»åˆ—
        "ç¾Šè‚‰": "ðŸ‘",
        "ç¾ŠæŽ’": "ðŸ–",
        "ç¾Šè…¿": "ðŸ‘",
        "ç¾Šé‡Œè„Š": "ðŸ‘",
        "ç¾Šè‚‹æŽ’": "ðŸ–",
        "ç¾ŠèŽå­": "ðŸ‘",
        "ç¾Šè‚": "ðŸ‘",
        "ç¾Šè‚š": "ðŸ‘",
        "ç¾Šéª¨": "ðŸ–",
        
        // ç¦½ç±»
        "é¸¡è‚‰": "ðŸ”",
        "é¸¡èƒ¸è‚‰": "ðŸ—",
        "é¸¡ç¿…": "ðŸ—",
        "é¸¡è…¿": "ðŸ—",
        "é¸¡ç¿…æ ¹": "ðŸ—",
        "é¸¡ç¿…ä¸­": "ðŸ—",
        "é¸¡çˆª": "ðŸ”",
        "é¸¡å¿ƒ": "ðŸ”",
        "é¸¡è‚": "ðŸ”",
        "é¸¡èƒ—": "ðŸ”",
        "ç«¥å­é¸¡": "ðŸ”",
        "ä¸‰é»„é¸¡": "ðŸ”",
        
        "é¸­è‚‰": "ðŸ¦†",
        "é¸­èƒ¸è‚‰": "ðŸ¦†",
        "é¸­è…¿": "ðŸ¦†",
        "é¸­ç¿…": "ðŸ¦†",
        "é¸­èˆŒ": "ðŸ¦†",
        "é¸­è‚": "ðŸ¦†",
        "é¸­èƒ—": "ðŸ¦†",
        "åŒ—äº¬çƒ¤é¸­": "ðŸ¦†",
        
        "é¹…è‚‰": "ðŸ¦¢",
        "é¹…èƒ¸è‚‰": "ðŸ¦¢",
        "é¹…è…¿": "ðŸ¦¢",
        "é¹…è‚": "ðŸ¦¢",
        "é¹…ç¿…": "ðŸ¦¢",
        
        // å…¶ä»–è‚‰ç±»
        "å…”è‚‰": "ðŸ°",
        "å…”è…¿": "ðŸ°",
        "å…”é‡Œè„Š": "ðŸ°",
        
        // åŠ å·¥è‚‰åˆ¶å“
        "ç«è…¿": "ðŸ–",
        "é¦™è‚ ": "ðŸŒ­",
        "åŸ¹æ ¹": "ðŸ¥“",
        "è…Šè‚ ": "ðŸŒ­",
        "è…Šè‚‰": "ðŸ¥“",
        "ç†è‚‰": "ðŸ¥“",
        "è‚‰æ¾": "ðŸ¥“",
        "è‚‰è„¯": "ðŸ¥“",
        
        // è›‹ç±»
        "é¸¡è›‹": "ðŸ¥š",
        "é¸­è›‹": "ðŸ¥š",
        "é¹…è›‹": "ðŸ¥š",
        "çš®è›‹": "ðŸ¥š",
        "å’¸è›‹": "ðŸ¥š",
        "èŒ¶å¶è›‹": "ðŸ¥š",
        "å’¸é¸­è›‹": "ðŸ¥š",
        "é¹Œé¹‘è›‹": "ðŸ¥š",
        
        // æµ·é²œç±»
        "è™¾": "ðŸ¦",
        "é¾™è™¾": "ðŸ¦ž",
        "èžƒèŸ¹": "ðŸ¦€",
        "é±¼": "ðŸŸ",
        "ä¸‰æ–‡é±¼": "ðŸŸ",
        "å¸¦é±¼": "ðŸŸ",
        "é²é±¼": "ðŸš",
        "ç”Ÿèš": "ðŸ¦ª",
        "é±¿é±¼": "ðŸ¦‘",
        "ç« é±¼": "ðŸ™",
        "æµ·å‚": "ðŸª¸",
        "é³—é±¼": "ðŸŸ",
        "æ‰‡è´": "ðŸš",
        "æµ·èœ‡": "ðŸŽ",
        "æµ·å¸¦": "ðŸŒ¿",
        "ç´«èœ": "ðŸŒ¿",
        
        // ä¹³åˆ¶å“
        "ç‰›å¥¶": "ðŸ¥›",
        "é…¸å¥¶": "ðŸ¥›",
        "å¥¶æ²¹": "ðŸ§ˆ",
        "é»„æ²¹": "ðŸ§ˆ",
        "å¥¶é…ª": "ðŸ§€",
        "èŠå£«": "ðŸ§€",
        
        // è°ƒå‘³æ–™
        "ç›": "ðŸ§‚",
        "ç³–": "ðŸ§‚",
        "èƒ¡æ¤’": "ðŸ§‚",
        "é…±æ²¹": "ðŸ«™",
        "é†‹": "ðŸ«™",
        "æ–™é…’": "ðŸ¶",
        "è’œ": "ðŸ§„",
        "å§œ": "ðŸ«š",
        "è¾£æ¤’ç²‰": "ðŸŒ¶ï¸",
        "èŠ±æ¤’": "ðŸ«˜",
        "å…«è§’": "â­ï¸",
        "æ¡‚çš®": "ðŸŒ³",
        "é¦™å¶": "ðŸƒ",
        "èŠéº»": "âš«ï¸",
        "èŠ¥æœ«": "ðŸŸ¡",
        "ç•ªèŒ„é…±": "ðŸ…",
        "èšæ²¹": "ðŸ¦ª",
        
        // åšæžœ
        "èŠ±ç”Ÿ": "ðŸ¥œ",
        "ç“œå­ä»": "ðŸŒ±",
        "æ ¸æ¡ƒ": "ðŸŒ°",
        "æä»": "ðŸ¥œ",
        "è…°æžœ": "ðŸ¥œ",
        "å¼€å¿ƒæžœ": "ðŸ¥œ",
        "æ¦›å­": "ðŸŒ°",
        "æ¾å­": "ðŸŒ°",
        "ç™½æžœ": "ðŸ¥œ",
        
        // é›¶é£Ÿå’Œç”œç‚¹
        "é¥¼å¹²": "ðŸª",
        "è–¯ç‰‡": "ðŸŸ",
        "å·§å…‹åŠ›": "ðŸ«",
        "è›‹ç³•": "ðŸ°",
        "å†°æ·‡æ·‹": "ðŸ¦",
        "ç”œç”œåœˆ": "ðŸ©",
        "æ£’æ£’ç³–": "ðŸ­",
        "ç³–æžœ": "ðŸ¬",
        "çˆ†ç±³èŠ±": "ðŸ¿",
        "å¸ƒä¸": "ðŸ®",
        "æœˆé¥¼": "ðŸ¥®",
        "éº»èŠ±": "ðŸ¥¨",
        "ç“œå­": "ðŸŒ±",
        "æžœå†»": "ðŸ«˜",
        
        // é¥®å“
        "èŒ¶": "ðŸ«–",
        "å’–å•¡": "â˜•ï¸",
        "å¯ä¹": "ðŸ¥¤",
        "æžœæ±": "ðŸ§ƒ",
        "å•¤é…’": "ðŸº",
        "çº¢é…’": "ðŸ·",
        "ç™½é…’": "ðŸ¥ƒ",
        "å¥¶èŒ¶": "ðŸ§‹",
        "æ¤°æ±": "ðŸ¥¥",
        "è±†æµ†": "ðŸ¥›",
        "çŸ¿æ³‰æ°´": "ðŸ’§"
    ]
    
    private let userDefaultsKey = "CustomIngredientEmojis"
    
    private init() {
        // ä»Ž UserDefaults åŠ è½½è‡ªå®šä¹‰è¡¨æƒ…ç¬¦å·
        if let savedEmojis = UserDefaults.standard.dictionary(forKey: userDefaultsKey) as? [String: String] {
            emojiMap.merge(savedEmojis) { (_, new) in new }
        }
    }
    
    // èŽ·å–é£Ÿæçš„è¡¨æƒ…ç¬¦å·
    func getEmoji(for ingredient: String) -> String? {
        // ç§»é™¤ç©ºæ ¼å¹¶è½¬æ¢ä¸ºå°å†™è¿›è¡ŒåŒ¹é…
        let normalizedName = ingredient.trimmingCharacters(in: .whitespaces).lowercased()
        
        // æŸ¥æ‰¾å®Œå…¨åŒ¹é…
        if let emoji = emojiMap[ingredient] {
            return emoji
        }
        
        // æŸ¥æ‰¾åŒ…å«å…³ç³»
        for (key, emoji) in emojiMap {
            if normalizedName.contains(key.lowercased()) {
                return emoji
            }
        }
        
        return nil
    }
    
    // æ·»åŠ æˆ–æ›´æ–°è‡ªå®šä¹‰è¡¨æƒ…ç¬¦å·
    func setEmoji(_ emoji: String, for ingredient: String) {
        emojiMap[ingredient] = emoji
        saveCustomEmojis()
    }
    
    // ä¿å­˜è‡ªå®šä¹‰è¡¨æƒ…ç¬¦å·åˆ° UserDefaults
    private func saveCustomEmojis() {
        UserDefaults.standard.set(emojiMap, forKey: userDefaultsKey)
    }
    
    // èŽ·å–æ‰€æœ‰é£Ÿæ
    var allIngredients: [String] {
        return Array(emojiMap.keys).sorted()
    }
    
    // èŽ·å–æŸä¸ªç±»åˆ«ä¸‹çš„æ‰€æœ‰é£Ÿæ
    func getIngredients(in category: String) -> [String] {
        return allIngredients.filter { ingredient in
            IngredientCategoryManager.shared.getCategory(for: ingredient) == category
        }
    }
}
