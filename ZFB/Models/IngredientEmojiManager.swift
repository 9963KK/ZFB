import Foundation

class IngredientEmojiManager {
    static let shared = IngredientEmojiManager()
    
    // 预定义的食材emoji映射
    private var emojiMap: [String: String] = [
        // 主食类
        "大米": "🍚",
        "糯米": "🍚",
        "小米": "🌾",
        "面条": "🍜",
        "面包": "🍞",
        "馒头": "🍞",
        "饺子": "🥟",
        "包子": "🍞",
        "花卷": "🥖",
        "油条": "🥖",
        "年糕": "🍘",
        "粽子": "🍙",
        "三明治": "🥪",
        "汉堡": "🍔",
        "披萨": "🍕",
        "寿司": "🍱",
        "春卷": "🥢",
        "炒饭": "🍚",
        "炒面": "🍜",
        
        // 水果类
        "苹果": "🍎",
        "青苹果": "🍏",
        "橘子": "🍊",
        "橙子": "🍊",
        "香蕉": "🍌",
        "葡萄": "🍇",
        "西瓜": "🍉",
        "桃子": "🍑",
        "梨": "🍐",
        "草莓": "🍓",
        "柠檬": "🍋",
        "樱桃": "🍒",
        "蓝莓": "🫐",
        "椰子": "🥥",
        "火龙果": "🥝",
        "猕猴桃": "🥝",
        "菠萝": "🍍",
        "柚子": "🍊",
        "石榴": "🫐",
        "山竹": "🫐",
        "芒果": "🥭",
        "榴莲": "🥝",
        "木瓜": "🥝",
        "枣": "🫐",
        "无花果": "🫐",
        "百香果": "🥝",
        
        // 蔬菜类
        "胡萝卜": "🥕",
        "西兰花": "🥦",
        "茄子": "🍆",
        "土豆": "🥔",
        "番茄": "🍅",
        "小番茄": "🍅",
        "玉米": "🌽",
        "生菜": "🥬",
        "卷心菜": "🥬",
        "辣椒": "🌶️",
        "青椒": "🫑",
        "蘑菇": "🍄",
        "大蒜": "🧄",
        "洋葱": "🧅",
        "黄瓜": "🥒",
        "豌豆": "🫛",
        "芦笋": "🥬",
        "菠菜": "🥬",
        "韭菜": "🥬",
        "白菜": "🥬",
        "南瓜": "🎃",
        "冬瓜": "🥬",
        "苦瓜": "🥒",
        "丝瓜": "🥒",
        "豆角": "🫛",
        "豆芽": "🌱",
        "莴笋": "🥬",
        "芹菜": "🥬",
        "萝卜": "🥕",
        "紫甘蓝": "🥬",
        "竹笋": "🎍",
        "山药": "🥔",
        "莲藕": "🥔",
        
        // 豆制品
        "豆腐": "🧊",
        "豆干": "🧊",
        "腐竹": "🧊",
        
        // 肉类
        // 猪肉系列
        "猪肉": "🐷",
        "五花肉": "🥓",
        "猪里脊": "🐷",
        "猪前腿": "🐷",
        "猪后腿": "🐷",
        "猪肘": "🐷",
        "猪蹄": "🐷",
        "猪排骨": "🍖",
        "猪肋排": "🍖",
        "猪腩肉": "🥓",
        "猪梅花肉": "🐷",
        "猪瘦肉": "🐷",
        "猪肝": "🐷",
        "猪心": "🐷",
        "猪肚": "🐷",
        "猪大肠": "🐷",
        "猪小肠": "🐷",
        
        // 牛肉系列
        "牛肉": "🐮",
        "牛里脊": "🥩",
        "牛排": "🥩",
        "牛腩": "🐮",
        "牛肋条": "🥩",
        "牛腱子": "🐮",
        "牛筋": "🐮",
        "牛肝": "🐮",
        "牛百叶": "🐮",
        "牛尾": "🐮",
        "牛舌": "🐮",
        "牛肚": "🐮",
        "牛骨": "🍖",
        "牛肋排": "🍖",
        "牛板腱": "🥩",
        "牛眼肉": "🥩",
        
        // 羊肉系列
        "羊肉": "🐑",
        "羊排": "🍖",
        "羊腿": "🐑",
        "羊里脊": "🐑",
        "羊肋排": "🍖",
        "羊蝎子": "🐑",
        "羊肝": "🐑",
        "羊肚": "🐑",
        "羊骨": "🍖",
        
        // 禽类
        "鸡肉": "🐔",
        "鸡胸肉": "🍗",
        "鸡翅": "🍗",
        "鸡腿": "🍗",
        "鸡翅根": "🍗",
        "鸡翅中": "🍗",
        "鸡爪": "🐔",
        "鸡心": "🐔",
        "鸡肝": "🐔",
        "鸡胗": "🐔",
        "童子鸡": "🐔",
        "三黄鸡": "🐔",
        
        "鸭肉": "🦆",
        "鸭胸肉": "🦆",
        "鸭腿": "🦆",
        "鸭翅": "🦆",
        "鸭舌": "🦆",
        "鸭肝": "🦆",
        "鸭胗": "🦆",
        "北京烤鸭": "🦆",
        
        "鹅肉": "🦢",
        "鹅胸肉": "🦢",
        "鹅腿": "🦢",
        "鹅肝": "🦢",
        "鹅翅": "🦢",
        
        // 其他肉类
        "兔肉": "🐰",
        "兔腿": "🐰",
        "兔里脊": "🐰",
        
        // 加工肉制品
        "火腿": "🍖",
        "香肠": "🌭",
        "培根": "🥓",
        "腊肠": "🌭",
        "腊肉": "🥓",
        "熏肉": "🥓",
        "肉松": "🥓",
        "肉脯": "🥓",
        
        // 蛋类
        "鸡蛋": "🥚",
        "鸭蛋": "🥚",
        "鹅蛋": "🥚",
        "皮蛋": "🥚",
        "咸蛋": "🥚",
        "茶叶蛋": "🥚",
        "咸鸭蛋": "🥚",
        "鹌鹑蛋": "🥚",
        
        // 海鲜类
        "虾": "🦐",
        "龙虾": "🦞",
        "螃蟹": "🦀",
        "鱼": "🐟",
        "三文鱼": "🐟",
        "带鱼": "🐟",
        "鲍鱼": "🐚",
        "生蚝": "🦪",
        "鱿鱼": "🦑",
        "章鱼": "🐙",
        "海参": "🪸",
        "鳗鱼": "🐟",
        "扇贝": "🐚",
        "海蜇": "🎐",
        "海带": "🌿",
        "紫菜": "🌿",
        
        // 乳制品
        "牛奶": "🥛",
        "酸奶": "🥛",
        "奶油": "🧈",
        "黄油": "🧈",
        "奶酪": "🧀",
        "芝士": "🧀",
        
        // 调味料
        "盐": "🧂",
        "糖": "🧂",
        "胡椒": "🧂",
        "酱油": "🫙",
        "醋": "🫙",
        "料酒": "🍶",
        "蒜": "🧄",
        "姜": "🫚",
        "辣椒粉": "🌶️",
        "花椒": "🫘",
        "八角": "⭐️",
        "桂皮": "🌳",
        "香叶": "🍃",
        "芝麻": "⚫️",
        "芥末": "🟡",
        "番茄酱": "🍅",
        "蚝油": "🦪",
        
        // 坚果
        "花生": "🥜",
        "瓜子仁": "🌱",
        "核桃": "🌰",
        "杏仁": "🥜",
        "腰果": "🥜",
        "开心果": "🥜",
        "榛子": "🌰",
        "松子": "🌰",
        "白果": "🥜",
        
        // 零食和甜点
        "饼干": "🍪",
        "薯片": "🍟",
        "巧克力": "🍫",
        "蛋糕": "🍰",
        "冰淇淋": "🍦",
        "甜甜圈": "🍩",
        "棒棒糖": "🍭",
        "糖果": "🍬",
        "爆米花": "🍿",
        "布丁": "🍮",
        "月饼": "🥮",
        "麻花": "🥨",
        "瓜子": "🌱",
        "果冻": "🫘",
        
        // 饮品
        "茶": "🫖",
        "咖啡": "☕️",
        "可乐": "🥤",
        "果汁": "🧃",
        "啤酒": "🍺",
        "红酒": "🍷",
        "白酒": "🥃",
        "奶茶": "🧋",
        "椰汁": "🥥",
        "豆浆": "🥛",
        "矿泉水": "💧"
    ]
    
    private let userDefaultsKey = "CustomIngredientEmojis"
    
    private init() {
        // 从 UserDefaults 加载自定义表情符号
        if let savedEmojis = UserDefaults.standard.dictionary(forKey: userDefaultsKey) as? [String: String] {
            emojiMap.merge(savedEmojis) { (_, new) in new }
        }
    }
    
    // 获取食材的表情符号
    func getEmoji(for ingredient: String) -> String? {
        // 移除空格并转换为小写进行匹配
        let normalizedName = ingredient.trimmingCharacters(in: .whitespaces).lowercased()
        
        // 查找完全匹配
        if let emoji = emojiMap[ingredient] {
            return emoji
        }
        
        // 查找包含关系
        for (key, emoji) in emojiMap {
            if normalizedName.contains(key.lowercased()) {
                return emoji
            }
        }
        
        return nil
    }
    
    // 添加或更新自定义表情符号
    func setEmoji(_ emoji: String, for ingredient: String) {
        emojiMap[ingredient] = emoji
        saveCustomEmojis()
    }
    
    // 保存自定义表情符号到 UserDefaults
    private func saveCustomEmojis() {
        UserDefaults.standard.set(emojiMap, forKey: userDefaultsKey)
    }
    
    // 获取所有食材
    var allIngredients: [String] {
        return Array(emojiMap.keys).sorted()
    }
    
    // 获取某个类别下的所有食材
    func getIngredients(in category: String) -> [String] {
        return allIngredients.filter { ingredient in
            IngredientCategoryManager.shared.getCategory(for: ingredient) == category
        }
    }
}
